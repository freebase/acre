<acre:script>
    if (acre.keystore.put) {
        var error = null;
        
        try {
            var keys = acre.keystore.keys();
        } catch (e) {
            error = "Keystore is not functional: " + e.message;
        }
        
        if (error == null && acre.request.method == 'POST') {
            var params = acre.request.body_params;
            var action = params.action || "add";
            var name = params.name;
            var token = params.token;
            var secret = params.secret;
            try {
                if (action == 'add') {
                    acre.keystore.put(name, token, secret);
                } else if (action == 'remove') {
                    acre.keystore.remove(name);
                }
                keys = acre.keystore.keys();
            } catch (e) {
                console.log(e);
                var message = e.getMessage();
            }
        }
    }
</acre:script>

<html>
    <head>
        <title>Keystore Manager</title>
        <link href='/acre/static/style.css' rel='stylesheet' type='text/css'>
    </head>
    <body>
        <div id="body">
            <acre:block if="error != null">
                <h1>Error</h1>
                <p>${error}</p>
            </acre:block>
            <acre:block elif="typeof acre.keystore.put == 'undefined'">
                <h1>Error</h1>
                <p>Sorry, the keystore console is only available in trusted mode.</p>
            </acre:block>
            <acre:block else="">
                <h1>Keystore Console</h1>
            
                <acre:block if="keys != null">
                    <h3>Existing Keys &not;</h3>
                    <ul>
                        <li acre:for="k in keys">
                            <form method="POST" action="">
                                <input type="hidden" name="action" value="remove">
                                <input type="hidden" name="name" value="${k}">
                                <acre:script>var key = acre.keystore.get(k);</acre:script>
                                <b>${k}</b> | ${key[0]} | ${key[1]} <input type="submit" name="remove" value="remove">
                            </form>
                        </li>
                    </ul>
                </acre:block>
                <acre:block else="">
                    <p>This app has no keys</p>
                </acre:block>
                
                <h3>Add a key &not;</h3>
                
                <form method="POST" action="">
                    <input type="hidden" name="action" value="add">
                    <table>
                        <tr><td>Name/Domain</td><td><input type="text" name="name" value=""></td></tr>
                        <tr><td>Consumer Token</td><td><input type="text" name="token" value=""></td></tr>
                        <tr><td>Consumer Secret</td><td><input type="text" name="secret" value=""></td></tr>
                    </table>
                    <div><input type="submit" value="add"></div>
                </form>
                
                <h3 acre:if="message">${message}</h3>
            </acre:block>
        </div>
    </body>
</html>