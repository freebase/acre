. bin/fixup-settings

#
#  patch up config files
#
cat >_sedfile <<EOF
s|@ACRE_LOGDIR@|$ACRE_LOGDIR|
s|@ACRE_LOG_LEVEL@|$ACRE_LOG_LEVEL|
s|@ACRE_DATADIR@|$ACRE_DATADIR|
s|@ACRE_JSLOGS@|$ACRE_JSLOGS|
s|@ACRE_ACCESSLOGS@|$ACRE_ACCESSLOGS|
s|@ACRE_METAWEB_BASE_ADDR@|$ACRE_METAWEB_BASE_ADDR|
s|@ACRE_METAWEB_API_ADDR@|$ACRE_METAWEB_API_ADDR|
s|@ACRE_METAWEB_API_ADDR_PORT@|$ACRE_METAWEB_API_ADDR_PORT|
s|@ACRE_FREEBASE_SITE_ADDR@|$ACRE_FREEBASE_SITE_ADDR|
s|@ACRE_FREEBASE_SITE_ADDR_PORT@|$ACRE_FREEBASE_SITE_ADDR_PORT|
s|@ACRE_GOOGLEAPIS_HOST@|$ACRE_GOOGLEAPIS_HOST|
s|@ACRE_GOOGLEAPIS_KEY@|$ACRE_GOOGLEAPIS_KEY|
s|@ACRE_GOOGLEAPIS_FREEBASE@|$ACRE_GOOGLEAPIS_FREEBASE|
s|@ACRE_MAX_CACHED_SCRIPT_CLASSES@|$ACRE_MAX_CACHED_SCRIPT_CLASSES|
s|@ACRE_HOST_BASE@|$ACRE_HOST_BASE|
s|@ACRE_HOST_DELIMITER_HOST@|$ACRE_HOST_DELIMITER_HOST|
s|@ACRE_HOST_DELIMITER_PATH@|$ACRE_HOST_DELIMITER_PATH|
s|@ACRE_HOST@|$ACRE_HOST|
s|@ACRE_PORT@|$ACRE_PORT|
s|@HTTP_PROXY_HOST@|$HTTP_PROXY_HOST|
s|@HTTP_PROXY_PORT@|$HTTP_PROXY_PORT|
s|@ACRE_WEBAPP@|$ACRE_WEBAPP|
s|@ACRE_WEBAPP_ROOT@|$ACRE_WEBAPP_ROOT|
s|@ACRE_SERVICE_ADDR@|$ACRE_SERVICE_ADDR|
s|@ACRE_VERSION@|$ACRE_VERSION|
s|@ACRE_AUTORELOADING@|$ACRE_AUTORELOADING|
s|@ACRE_SUICIDE@|$ACRE_SUICIDE|
s|@ACRE_SUICIDE_LIFETIME@|$ACRE_SUICIDE_LIFETIME|
s|@ACRE_SQL@|$ACRE_SQL|
s|@ACRE_SQL_USER@|$ACRE_SQL_USER|
s|@ACRE_SQL_PASSWORD@|$ACRE_SQL_PASSWORD|
s|@ACRE_SQL_TABLE@|$ACRE_SQL_TABLE|
s|@ACRE_SQL_TABLE_VERSION@|$ACRE_SQL_TABLE_VERSION|
s|@STATIC_SCRIPT_PATH@|$STATIC_SCRIPT_PATH|
s|@ACRE_LIMIT_EXECUTION_TIME@|$ACRE_LIMIT_EXECUTION_TIME|
s|@ACRE_COMPILER_OPTIMIZATION_LEVEL@|$ACRE_COMPILER_OPTIMIZATION_LEVEL|
s|@ACRE_DEVELOPER_MODE@|$ACRE_DEVELOPER_MODE|
s|@ACRE_TRUSTED_MODE@|$ACRE_TRUSTED_MODE|
s|@ACRE_MAX_OBJECT_COUNT_PER_SCRIPT@|$ACRE_MAX_OBJECT_COUNT_PER_SCRIPT|
s|@ACRE_MAX_ASYNC_CONNECTIONS@|$ACRE_MAX_ASYNC_CONNECTIONS|
EOF

for file in `find webapp/META-INF -name \*.in` ; do
    sed -f _sedfile < $file > `echo $file | sed 's/\.in//'` || exit 1
done

rm -f _sedfile
